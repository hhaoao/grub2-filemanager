<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=UTF-8">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc2 {
	color: #008040;
}
.sc3 {
}
.sc4 {
	font-weight: bold;
	color: #0000FF;
}
.sc5 {
	color: #0000FF;
}
.sc6 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #9F0000;
}
.sc13 {
	color: #FF8000;
}
.sc14 {
	font-weight: bold;
	color: #0000A0;
}
.sc16 {
	color: #008000;
}
.sc17 {
	color: #008000;
}
.sc18 {
	color: #FF0000;
}
.sc19 {
	color: #0000FF;
	background: #80FFFF;
}
.sc20 {
	color: #FF00FF;
}
.sc24 {
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc2"># Grub2-FileManager
# Copyright (C) 2016,2017,2018  A1ive.
#
# Grub2-FileManager is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# Grub2-FileManager is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with Grub2-FileManager.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
</span><span class="sc24">
</span><span class="sc6">function</span><span class="sc24"> </span><span class="sc0">grubfm_init</span><span class="sc24"> </span><span class="sc13">{</span><span class="sc24">
    </span><span class="sc5">insmod</span><span class="sc24"> </span><span class="sc5">loopback</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc5">insmod</span><span class="sc24"> </span><span class="sc5">probe</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc5">insmod</span><span class="sc24"> </span><span class="sc0">progress</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc5">insmod</span><span class="sc24"> </span><span class="sc5">regexp</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">debug</span><span class="sc12">=</span><span class="sc24"> </span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">enable_progress_indicator</span><span class="sc12">=</span><span class="sc3">0</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">grub_exe</span><span class="sc12">=</span><span class="sc16">"/boot/grub/grub.exe"</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">grub_fm</span><span class="sc12">=</span><span class="sc16">"/boot/grub/grubfm.cfg"</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">grub_ipxe</span><span class="sc12">=</span><span class="sc16">"/boot/grub/ipxe.lkrn"</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">grub_memdisk</span><span class="sc12">=</span><span class="sc16">"/boot/grub/memdisk"</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">grub_wimboot</span><span class="sc12">=</span><span class="sc16">"/boot/grub/wimboot"</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">pager</span><span class="sc12">=</span><span class="sc3">0</span><span class="sc12">;</span><span class="sc24">
</span><span class="sc13">}</span><span class="sc24">

</span><span class="sc2"># grubfm_main PATH
</span><span class="sc6">function</span><span class="sc24"> </span><span class="sc0">grubfm_main</span><span class="sc24"> </span><span class="sc13">{</span><span class="sc24">
    </span><span class="sc14">if</span><span class="sc24"> </span><span class="sc5">test</span><span class="sc24"> </span><span class="sc0">-z</span><span class="sc24"> </span><span class="sc16">"${1}"</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
        </span><span class="sc14">for</span><span class="sc24"> </span><span class="sc0">device</span><span class="sc24"> </span><span class="sc6">in</span><span class="sc24"> </span><span class="sc18">(*)</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc14">do</span><span class="sc24">
            </span><span class="sc14">if</span><span class="sc24"> </span><span class="sc5">test</span><span class="sc24"> </span><span class="sc0">-d</span><span class="sc24"> </span><span class="sc16">"${device}"</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
                </span><span class="sc5">probe</span><span class="sc24"> </span><span class="sc0">--set</span><span class="sc12">=</span><span class="sc0">fs</span><span class="sc24"> </span><span class="sc0">-f</span><span class="sc24"> </span><span class="sc16">"${device}"</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">probe</span><span class="sc24"> </span><span class="sc0">--set</span><span class="sc12">=</span><span class="sc0">label</span><span class="sc24"> </span><span class="sc0">-l</span><span class="sc24"> </span><span class="sc16">"${device}"</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc14">if</span><span class="sc24"> </span><span class="sc5">regexp</span><span class="sc24"> </span><span class="sc17">'loop'</span><span class="sc24"> </span><span class="sc16">"${device}"</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
                    </span><span class="sc6">continue</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc14">elif</span><span class="sc24"> </span><span class="sc5">test</span><span class="sc24"> </span><span class="sc16">"$fs"</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24"> </span><span class="sc16">"udf"</span><span class="sc24"> </span><span class="sc0">-o</span><span class="sc24"> </span><span class="sc16">"$fs"</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24"> </span><span class="sc16">"iso9660"</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
                    </span><span class="sc0">icon</span><span class="sc12">=</span><span class="sc16">"iso"</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc14">elif</span><span class="sc24"> </span><span class="sc5">test</span><span class="sc24"> </span><span class="sc16">"${device}"</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24"> </span><span class="sc16">"(memdisk)"</span><span class="sc24"> </span><span class="sc0">-o</span><span class="sc24"> </span><span class="sc16">"${device}"</span><span class="sc24"> </span><span class="sc12">=</span><span class="sc24"> </span><span class="sc16">"(proc)"</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
                    </span><span class="sc6">continue</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc14">else</span><span class="sc24">
                    </span><span class="sc0">icon</span><span class="sc12">=</span><span class="sc16">"hdd"</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc14">fi</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc4">menuentry</span><span class="sc24"> </span><span class="sc16">"${device} [$fs] $label"</span><span class="sc24"> </span><span class="sc16">"${device}"</span><span class="sc24"> </span><span class="sc0">--class</span><span class="sc24"> </span><span class="sc12">$</span><span class="sc0">icon</span><span class="sc13">{</span><span class="sc24">
                    </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">grub_path</span><span class="sc12">=</span><span class="sc16">"$2"</span><span class="sc12">;</span><span class="sc24">
                    </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">grub_load</span><span class="sc12">=</span><span class="sc16">""</span><span class="sc12">;</span><span class="sc24">
                    </span><span class="sc5">export</span><span class="sc24"> </span><span class="sc0">grub_path</span><span class="sc12">;</span><span class="sc24">
                    </span><span class="sc5">configfile</span><span class="sc24"> </span><span class="sc19">${grub_fm}</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc13">}</span><span class="sc24">
                </span><span class="sc5">unset</span><span class="sc24"> </span><span class="sc0">label</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">unset</span><span class="sc24"> </span><span class="sc0">fs</span><span class="sc12">;</span><span class="sc24">
            </span><span class="sc14">fi</span><span class="sc12">;</span><span class="sc24">
        </span><span class="sc14">done</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc14">else</span><span class="sc24">
        </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">grub_path</span><span class="sc12">=</span><span class="sc16">"${1}"</span><span class="sc12">;</span><span class="sc24">
        </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">default</span><span class="sc12">=</span><span class="sc3">1</span><span class="sc12">;</span><span class="sc24">
        </span><span class="sc4">menuentry</span><span class="sc24"> </span><span class="sc16">".."</span><span class="sc24"> </span><span class="sc0">--class</span><span class="sc24"> </span><span class="sc0">go-previous</span><span class="sc13">{</span><span class="sc24">
            </span><span class="sc14">if</span><span class="sc24"> </span><span class="sc12">!</span><span class="sc24"> </span><span class="sc5">regexp</span><span class="sc24"> </span><span class="sc0">--set</span><span class="sc12">=</span><span class="sc0">grub_path</span><span class="sc24"> </span><span class="sc17">'(^.*)/.*$'</span><span class="sc24"> </span><span class="sc16">"${grub_path}"</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
                </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">grub_path</span><span class="sc12">=</span><span class="sc16">""</span><span class="sc12">;</span><span class="sc24">
            </span><span class="sc14">fi</span><span class="sc24">
            </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">grub_load</span><span class="sc12">=</span><span class="sc16">""</span><span class="sc12">;</span><span class="sc24">
            </span><span class="sc5">export</span><span class="sc24"> </span><span class="sc0">grub_path</span><span class="sc12">;</span><span class="sc24">
            </span><span class="sc5">configfile</span><span class="sc24"> </span><span class="sc19">${grub_fm}</span><span class="sc12">;</span><span class="sc24">
        </span><span class="sc13">}</span><span class="sc24">
        </span><span class="sc14">for</span><span class="sc24"> </span><span class="sc0">item</span><span class="sc24"> </span><span class="sc6">in</span><span class="sc24"> </span><span class="sc19">${grub_path}</span><span class="sc12">/</span><span class="sc0">*</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc14">do</span><span class="sc24">
            </span><span class="sc5">regexp</span><span class="sc24"> </span><span class="sc0">--set</span><span class="sc12">=</span><span class="sc0">name</span><span class="sc24"> </span><span class="sc17">'.*/(.*)$'</span><span class="sc24"> </span><span class="sc16">"${item}"</span><span class="sc12">;</span><span class="sc24">
            </span><span class="sc14">if</span><span class="sc24"> </span><span class="sc5">test</span><span class="sc24"> </span><span class="sc0">-d</span><span class="sc24"> </span><span class="sc16">"${item}"</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
                </span><span class="sc4">menuentry</span><span class="sc24"> </span><span class="sc16">"[${name}]"</span><span class="sc24"> </span><span class="sc16">"${item}"</span><span class="sc24"> </span><span class="sc0">--class</span><span class="sc24"> </span><span class="sc0">dir</span><span class="sc13">{</span><span class="sc24">
                    </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">grub_path</span><span class="sc12">=</span><span class="sc16">"$2"</span><span class="sc12">;</span><span class="sc24">
                    </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">grub_load</span><span class="sc12">=</span><span class="sc16">""</span><span class="sc12">;</span><span class="sc24">
                    </span><span class="sc5">export</span><span class="sc24"> </span><span class="sc0">grub_path</span><span class="sc12">;</span><span class="sc24">
                    </span><span class="sc5">configfile</span><span class="sc24"> </span><span class="sc19">${grub_fm}</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc13">}</span><span class="sc24">
            </span><span class="sc14">elif</span><span class="sc24"> </span><span class="sc5">test</span><span class="sc24"> </span><span class="sc0">-f</span><span class="sc24"> </span><span class="sc16">"${item}"</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
                </span><span class="sc4">menuentry</span><span class="sc24"> </span><span class="sc16">"${name}"</span><span class="sc24"> </span><span class="sc16">"${item}"</span><span class="sc24"> </span><span class="sc0">--class</span><span class="sc24"> </span><span class="sc5">file</span><span class="sc13">{</span><span class="sc24">
                    </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">grub_file</span><span class="sc12">=</span><span class="sc16">"$2"</span><span class="sc12">;</span><span class="sc24">
                    </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">grub_load</span><span class="sc12">=</span><span class="sc16">"grubfm_open"</span><span class="sc12">;</span><span class="sc24">
                    </span><span class="sc5">export</span><span class="sc24"> </span><span class="sc0">grub_file</span><span class="sc12">;</span><span class="sc24">
                    </span><span class="sc5">export</span><span class="sc24"> </span><span class="sc0">grub_path</span><span class="sc12">;</span><span class="sc24">
                    </span><span class="sc5">export</span><span class="sc24"> </span><span class="sc0">grub_load</span><span class="sc12">;</span><span class="sc24">
                    </span><span class="sc5">configfile</span><span class="sc24"> </span><span class="sc19">${grub_fm}</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc13">}</span><span class="sc24">
            </span><span class="sc14">else</span><span class="sc24">
                </span><span class="sc6">continue</span><span class="sc12">;</span><span class="sc24">
            </span><span class="sc14">fi</span><span class="sc12">;</span><span class="sc24">
        </span><span class="sc14">done</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc14">fi</span><span class="sc12">;</span><span class="sc24">
</span><span class="sc13">}</span><span class="sc24">
</span><span class="sc2"># grubfm_open FILE
</span><span class="sc6">function</span><span class="sc24"> </span><span class="sc0">grubfm_open</span><span class="sc24"> </span><span class="sc13">{</span><span class="sc24">
    </span><span class="sc5">unset</span><span class="sc24"> </span><span class="sc0">name</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc5">unset</span><span class="sc24"> </span><span class="sc0">name_ext</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">grub_file</span><span class="sc12">=</span><span class="sc16">"${1}"</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">grub_load</span><span class="sc12">=</span><span class="sc16">""</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc5">regexp</span><span class="sc24"> </span><span class="sc0">--set</span><span class="sc12">=</span><span class="sc0">name</span><span class="sc24"> </span><span class="sc17">'.*/(.*)$'</span><span class="sc24"> </span><span class="sc16">"${grub_file}"</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc5">regexp</span><span class="sc24"> </span><span class="sc0">--set</span><span class="sc12">=</span><span class="sc0">name_ext</span><span class="sc24"> </span><span class="sc17">'^.*\.(.*$)'</span><span class="sc24"> </span><span class="sc16">"${grub_file}"</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">default</span><span class="sc12">=</span><span class="sc3">1</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc4">menuentry</span><span class="sc24"> </span><span class="sc16">"返回"</span><span class="sc24"> </span><span class="sc0">--class</span><span class="sc24"> </span><span class="sc0">go-previous</span><span class="sc13">{</span><span class="sc24">
        </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">grub_load</span><span class="sc12">=</span><span class="sc16">""</span><span class="sc12">;</span><span class="sc24">
        </span><span class="sc5">export</span><span class="sc24"> </span><span class="sc0">grub_path</span><span class="sc12">;</span><span class="sc24">
        </span><span class="sc5">configfile</span><span class="sc24"> </span><span class="sc19">${grub_fm}</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc13">}</span><span class="sc24">
    </span><span class="sc2"># cfg efi ima/img iso wim ipxe
</span><span class="sc24">    </span><span class="sc14">if</span><span class="sc24"> </span><span class="sc5">regexp</span><span class="sc24"> </span><span class="sc17">'^[cC][fF][gG]$'</span><span class="sc24"> </span><span class="sc16">"${name_ext}"</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
        </span><span class="sc4">menuentry</span><span class="sc24"> </span><span class="sc16">"加载GRUB2菜单"</span><span class="sc24"> </span><span class="sc0">--class</span><span class="sc24"> </span><span class="sc0">cfg</span><span class="sc13">{</span><span class="sc24">
            </span><span class="sc5">regexp</span><span class="sc24"> </span><span class="sc0">--set</span><span class="sc12">=</span><span class="sc0">root</span><span class="sc24"> </span><span class="sc17">'^\(([0-9a-zA-Z,]+)\).*$'</span><span class="sc24"> </span><span class="sc16">"${grub_file}"</span><span class="sc12">;</span><span class="sc24">
            </span><span class="sc5">configfile</span><span class="sc24"> </span><span class="sc19">${grub_file}</span><span class="sc12">;</span><span class="sc24">
        </span><span class="sc13">}</span><span class="sc24">
    </span><span class="sc14">elif</span><span class="sc24"> </span><span class="sc5">regexp</span><span class="sc24"> </span><span class="sc17">'^[eE][fF][iI]$'</span><span class="sc24"> </span><span class="sc16">"${name_ext}"</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
        </span><span class="sc14">if</span><span class="sc24"> </span><span class="sc20">[ "$grub_platform" = "efi" ]</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
            </span><span class="sc4">menuentry</span><span class="sc24"> </span><span class="sc16">"运行EFI程序"</span><span class="sc24"> </span><span class="sc0">--class</span><span class="sc24"> </span><span class="sc0">uefi</span><span class="sc13">{</span><span class="sc24">
                </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">enable_progress_indicator</span><span class="sc12">=</span><span class="sc3">1</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">regexp</span><span class="sc24"> </span><span class="sc0">--set</span><span class="sc12">=</span><span class="sc0">root</span><span class="sc24"> </span><span class="sc17">'^\(([0-9a-zA-Z,]+)\).*$'</span><span class="sc24"> </span><span class="sc16">"${grub_file}"</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">chainloader</span><span class="sc24"> </span><span class="sc19">${grub_file}</span><span class="sc12">;</span><span class="sc24">
            </span><span class="sc13">}</span><span class="sc24">
        </span><span class="sc14">fi</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc14">elif</span><span class="sc24"> </span><span class="sc5">regexp</span><span class="sc24"> </span><span class="sc17">'^[iI][mM][aAgG]$'</span><span class="sc24"> </span><span class="sc16">"${name_ext}"</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
        </span><span class="sc14">if</span><span class="sc24"> </span><span class="sc20">[ "$grub_platform" = "pc" ]</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
            </span><span class="sc4">menuentry</span><span class="sc24"> </span><span class="sc16">"仿真启动软盘镜像 (grub.exe)"</span><span class="sc24"> </span><span class="sc0">--class</span><span class="sc24"> </span><span class="sc0">img</span><span class="sc13">{</span><span class="sc24">
                </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">enable_progress_indicator</span><span class="sc12">=</span><span class="sc3">1</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">g4d_cmd</span><span class="sc12">=</span><span class="sc16">"map --mem (rd)+1 (fd0);map --hook;rootnoverify (fd0);chainloader +1"</span><span class="sc24">
                </span><span class="sc5">linux16</span><span class="sc24"> </span><span class="sc19">${grub_exe}</span><span class="sc24"> </span><span class="sc0">--config-file</span><span class="sc12">=$</span><span class="sc0">g4d_cmd</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">initrd16</span><span class="sc24"> </span><span class="sc19">${grub_file}</span><span class="sc12">;</span><span class="sc24">
            </span><span class="sc13">}</span><span class="sc24">
            </span><span class="sc4">menuentry</span><span class="sc24"> </span><span class="sc16">"仿真启动软盘镜像 (memdisk)"</span><span class="sc24"> </span><span class="sc0">--class</span><span class="sc24"> </span><span class="sc0">img</span><span class="sc13">{</span><span class="sc24">
                </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">enable_progress_indicator</span><span class="sc12">=</span><span class="sc3">1</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">linux16</span><span class="sc24"> </span><span class="sc19">${grub_memdisk}</span><span class="sc24"> </span><span class="sc0">floppy</span><span class="sc24"> </span><span class="sc0">raw</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">initrd16</span><span class="sc24"> </span><span class="sc19">${grub_file}</span><span class="sc12">;</span><span class="sc24">
            </span><span class="sc13">}</span><span class="sc24">
            </span><span class="sc4">menuentry</span><span class="sc24"> </span><span class="sc16">"仿真启动硬盘镜像 (grub.exe)"</span><span class="sc24"> </span><span class="sc0">--class</span><span class="sc24"> </span><span class="sc0">img</span><span class="sc13">{</span><span class="sc24">
                </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">enable_progress_indicator</span><span class="sc12">=</span><span class="sc3">1</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">g4d_cmd</span><span class="sc12">=</span><span class="sc16">"map --mem (rd)+1 (hd-1);map --hook;rootnoverify (hd-1);chainloader +1"</span><span class="sc24">
                </span><span class="sc5">linux16</span><span class="sc24"> </span><span class="sc19">${grub_exe}</span><span class="sc24"> </span><span class="sc0">--config-file</span><span class="sc12">=$</span><span class="sc0">g4d_cmd</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">initrd16</span><span class="sc24"> </span><span class="sc19">${grub_file}</span><span class="sc12">;</span><span class="sc24">
            </span><span class="sc13">}</span><span class="sc24">
            </span><span class="sc4">menuentry</span><span class="sc24"> </span><span class="sc16">"仿真启动硬盘镜像 (memdisk)"</span><span class="sc24"> </span><span class="sc0">--class</span><span class="sc24"> </span><span class="sc0">img</span><span class="sc13">{</span><span class="sc24">
                </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">enable_progress_indicator</span><span class="sc12">=</span><span class="sc3">1</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">linux16</span><span class="sc24"> </span><span class="sc19">${grub_memdisk}</span><span class="sc24"> </span><span class="sc0">harddisk</span><span class="sc24"> </span><span class="sc0">raw</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">initrd16</span><span class="sc24"> </span><span class="sc19">${grub_file}</span><span class="sc12">;</span><span class="sc24">
            </span><span class="sc13">}</span><span class="sc24">
        </span><span class="sc14">fi</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc14">elif</span><span class="sc24"> </span><span class="sc5">regexp</span><span class="sc24"> </span><span class="sc17">'^[iI][sS][oO]$'</span><span class="sc24"> </span><span class="sc16">"${name_ext}"</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
        </span><span class="sc5">loopback</span><span class="sc24"> </span><span class="sc0">loop</span><span class="sc24"> </span><span class="sc19">${grub_file}</span><span class="sc12">;</span><span class="sc24">
        </span><span class="sc14">if</span><span class="sc24"> </span><span class="sc5">test</span><span class="sc24"> </span><span class="sc0">-f</span><span class="sc24"> </span><span class="sc18">(loop)</span><span class="sc12">/</span><span class="sc5">boot</span><span class="sc12">/</span><span class="sc0">grub</span><span class="sc12">/</span><span class="sc0">loopback.cfg</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
            </span><span class="sc4">menuentry</span><span class="sc24"> </span><span class="sc16">"加载ISO Loopback菜单"</span><span class="sc24"> </span><span class="sc0">--class</span><span class="sc24"> </span><span class="sc0">gnu-linux</span><span class="sc13">{</span><span class="sc24">
                </span><span class="sc5">regexp</span><span class="sc24"> </span><span class="sc0">--set</span><span class="sc12">=</span><span class="sc0">iso_path</span><span class="sc24"> </span><span class="sc17">'(/.*)$'</span><span class="sc24"> </span><span class="sc16">"${grub_file}"</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">regexp</span><span class="sc24"> </span><span class="sc0">--set</span><span class="sc12">=</span><span class="sc0">iso_device</span><span class="sc24"> </span><span class="sc17">'^(\([0-9a-zA-Z,]+\))/.*'</span><span class="sc24"> </span><span class="sc16">"${grub_file}"</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">probe</span><span class="sc24"> </span><span class="sc0">--set</span><span class="sc12">=</span><span class="sc0">rootuuid</span><span class="sc24"> </span><span class="sc0">-u</span><span class="sc24"> </span><span class="sc16">"${iso_device}"</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">export</span><span class="sc24"> </span><span class="sc0">iso_path</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">export</span><span class="sc24"> </span><span class="sc0">rootuuid</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">root</span><span class="sc12">=</span><span class="sc0">loop</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">configfile</span><span class="sc24"> </span><span class="sc12">/</span><span class="sc5">boot</span><span class="sc12">/</span><span class="sc0">grub</span><span class="sc12">/</span><span class="sc0">loopback.cfg</span><span class="sc24">
            </span><span class="sc13">}</span><span class="sc24">
        </span><span class="sc14">fi</span><span class="sc12">;</span><span class="sc24">
        </span><span class="sc14">if</span><span class="sc24"> </span><span class="sc20">[ "$grub_platform" = "pc" ]</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
            </span><span class="sc4">menuentry</span><span class="sc24"> </span><span class="sc16">"仿真启动光盘镜像 (grub.exe)"</span><span class="sc24"> </span><span class="sc0">--class</span><span class="sc24"> </span><span class="sc0">iso</span><span class="sc13">{</span><span class="sc24">
                </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">enable_progress_indicator</span><span class="sc12">=</span><span class="sc3">1</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">g4d_cmd</span><span class="sc12">=</span><span class="sc16">"map --mem (rd)+1 (0xff);map --hook;chainloader (0xff)"</span><span class="sc24">
                </span><span class="sc5">linux16</span><span class="sc24"> </span><span class="sc19">${grub_exe}</span><span class="sc24"> </span><span class="sc0">--config-file</span><span class="sc12">=$</span><span class="sc0">g4d_cmd</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">initrd16</span><span class="sc24"> </span><span class="sc19">${grub_file}</span><span class="sc12">;</span><span class="sc24">
            </span><span class="sc13">}</span><span class="sc24">
            </span><span class="sc4">menuentry</span><span class="sc24"> </span><span class="sc16">"仿真启动光盘镜像 (memdisk)"</span><span class="sc24"> </span><span class="sc0">--class</span><span class="sc24"> </span><span class="sc0">iso</span><span class="sc13">{</span><span class="sc24">
                </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">enable_progress_indicator</span><span class="sc12">=</span><span class="sc3">1</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">linux16</span><span class="sc24"> </span><span class="sc19">${grub_memdisk}</span><span class="sc24"> </span><span class="sc0">iso</span><span class="sc24"> </span><span class="sc0">raw</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">initrd16</span><span class="sc24"> </span><span class="sc19">${grub_file}</span><span class="sc12">;</span><span class="sc24">
            </span><span class="sc13">}</span><span class="sc24">
        </span><span class="sc14">fi</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc14">elif</span><span class="sc24"> </span><span class="sc5">regexp</span><span class="sc24"> </span><span class="sc17">'^[wW][iI][mM]$'</span><span class="sc24"> </span><span class="sc16">"${name_ext}"</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
        </span><span class="sc14">if</span><span class="sc24"> </span><span class="sc20">[ "$grub_platform" = "pc" ]</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
            </span><span class="sc4">menuentry</span><span class="sc24"> </span><span class="sc16">"启动 NT6 WIM"</span><span class="sc24"> </span><span class="sc0">--class</span><span class="sc24"> </span><span class="sc0">wim</span><span class="sc13">{</span><span class="sc24">
                </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">enable_progress_indicator</span><span class="sc12">=</span><span class="sc3">1</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">loopback</span><span class="sc24"> </span><span class="sc0">wimboot</span><span class="sc24"> </span><span class="sc19">${grub_wimboot}</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">linux16</span><span class="sc24"> </span><span class="sc18">(wimboot)</span><span class="sc12">/</span><span class="sc0">wimboot</span><span class="sc24"> </span><span class="sc0">gui</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">initrd16</span><span class="sc24"> </span><span class="sc0">newc:bootmgr:</span><span class="sc18">(wimboot)</span><span class="sc12">/</span><span class="sc0">bootmgr</span><span class="sc24"> </span><span class="sc0">\</span><span class="sc24">
                    </span><span class="sc0">newc:bcd:</span><span class="sc18">(wimboot)</span><span class="sc12">/</span><span class="sc0">bcd</span><span class="sc24"> </span><span class="sc0">\</span><span class="sc24">
                    </span><span class="sc0">newc:boot.sdi:</span><span class="sc18">(wimboot)</span><span class="sc12">/</span><span class="sc0">boot.sdi</span><span class="sc24"> </span><span class="sc0">\</span><span class="sc24">
                    </span><span class="sc0">newc:boot.wim:</span><span class="sc19">${grub_file}</span><span class="sc12">;</span><span class="sc24">
            </span><span class="sc13">}</span><span class="sc24">
        </span><span class="sc14">fi</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc14">elif</span><span class="sc24"> </span><span class="sc5">regexp</span><span class="sc24"> </span><span class="sc17">'^[iI][pP][xX][eE]$'</span><span class="sc24"> </span><span class="sc16">"${name_ext}"</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
        </span><span class="sc14">if</span><span class="sc24"> </span><span class="sc20">[ "$grub_platform" = "pc" ]</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
            </span><span class="sc4">menuentry</span><span class="sc24"> </span><span class="sc16">"加载iPXE菜单"</span><span class="sc24"> </span><span class="sc0">--class</span><span class="sc24"> </span><span class="sc0">net</span><span class="sc13">{</span><span class="sc24">
                </span><span class="sc5">set</span><span class="sc24"> </span><span class="sc0">enable_progress_indicator</span><span class="sc12">=</span><span class="sc3">1</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">linux16</span><span class="sc24"> </span><span class="sc19">${grub_ipxe}</span><span class="sc12">;</span><span class="sc24">
                </span><span class="sc5">initrd16</span><span class="sc24"> </span><span class="sc19">${grub_file}</span><span class="sc12">;</span><span class="sc24">
            </span><span class="sc13">}</span><span class="sc24">
        </span><span class="sc14">fi</span><span class="sc12">;</span><span class="sc24">
    </span><span class="sc14">elif</span><span class="sc24"> </span><span class="sc5">file</span><span class="sc24"> </span><span class="sc0">--is-x86-multiboot</span><span class="sc24"> </span><span class="sc16">"${grub_file}"</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
        </span><span class="sc4">menuentry</span><span class="sc24"> </span><span class="sc16">"启动Multiboot内核"</span><span class="sc24">  </span><span class="sc0">--class</span><span class="sc24"> </span><span class="sc0">exe</span><span class="sc13">{</span><span class="sc24">
            </span><span class="sc5">multiboot</span><span class="sc24"> </span><span class="sc16">"${grub_file}"</span><span class="sc12">;</span><span class="sc24">
        </span><span class="sc13">}</span><span class="sc24">
    </span><span class="sc14">elif</span><span class="sc24"> </span><span class="sc5">file</span><span class="sc24"> </span><span class="sc0">--is-x86-multiboot2</span><span class="sc24"> </span><span class="sc16">"${grub_file}"</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
        </span><span class="sc4">menuentry</span><span class="sc24"> </span><span class="sc16">"启动Multiboot2内核"</span><span class="sc24">  </span><span class="sc0">--class</span><span class="sc24"> </span><span class="sc0">exe</span><span class="sc13">{</span><span class="sc24">
            </span><span class="sc5">multiboot2</span><span class="sc24"> </span><span class="sc16">"${grub_file}"</span><span class="sc12">;</span><span class="sc24">
        </span><span class="sc13">}</span><span class="sc24">
    </span><span class="sc14">elif</span><span class="sc24"> </span><span class="sc5">file</span><span class="sc24"> </span><span class="sc0">--is-x86-linux</span><span class="sc24"> </span><span class="sc16">"${grub_file}"</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
        </span><span class="sc4">menuentry</span><span class="sc24"> </span><span class="sc16">"启动Linux内核"</span><span class="sc24">  </span><span class="sc0">--class</span><span class="sc24"> </span><span class="sc0">exe</span><span class="sc13">{</span><span class="sc24">
            </span><span class="sc5">linux</span><span class="sc24"> </span><span class="sc16">"${grub_file}"</span><span class="sc12">;</span><span class="sc24">
        </span><span class="sc13">}</span><span class="sc24">
    </span><span class="sc14">fi</span><span class="sc12">;</span><span class="sc24">
</span><span class="sc13">}</span><span class="sc24">

</span><span class="sc0">grubfm_init</span><span class="sc12">;</span><span class="sc24">
</span><span class="sc14">if</span><span class="sc24"> </span><span class="sc20">[ "${grub_load}" = "grubfm_open" ]</span><span class="sc12">;</span><span class="sc24"> </span><span class="sc6">then</span><span class="sc24">
    </span><span class="sc0">grubfm_open</span><span class="sc24"> </span><span class="sc16">"${grub_file}"</span><span class="sc12">;</span><span class="sc24">
</span><span class="sc14">else</span><span class="sc24">
    </span><span class="sc0">grubfm_main</span><span class="sc24"> </span><span class="sc16">"${grub_path}"</span><span class="sc12">;</span><span class="sc24">
</span><span class="sc14">fi</span><span class="sc12">;</span><span class="sc24">
</span></div></body>
</html>
